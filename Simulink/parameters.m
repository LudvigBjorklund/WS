timestep =4;
dt = 2^(-timestep);

SOC_init = 80;
I = 2;

% Battery internal resistance lookup table data
% For use with 2D lookup table in Simulink

% SOC breakpoints (State of Charge) [%]
SOC_bp = [0, 10, 20, 30, 40, 50, 60, 70, 80, 90, 100];

% Current breakpoints [A]
I_bp = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16];


% Internal resistance table R0 [ohms]
% Rows correspond to current values (I_bp)
% Columns correspond to SOC values (SOC_bp)
R0_tbl = [
    127,    50,     35,     25,     17,     15,     14,     13,     12.5,   11,     9;
    125,    40,     27,     20,     16,     14,     12,     11,     10,     9,      8;
    123,    32,     24,     19,     15,     13,     11,     10,     9.5,    8.5,    7.5;
    120,    25,     22,     18,     14,     12,     10.5,   9.5,    8.5,    7,      6;
    110,    20,     18,     17,     13,     11,     10,     9,      7.75,   6.75,   5.5;
    95,     17,     15,     14,     12,     10,     9,      8,      7.25,   6.5,    5.25;
    80,     16,     14,     13,     11,     9,      8,      7.5,    7,      6.25,   5.125;
    71,     15,     13,     12,     10,     7.5,    6.75,   6.5,    6.25,   6,      5;
    63,     14,     12,     10,     9.25,   6,      5.75,   5.5,    5.375,  5.125,  4.9;
    54,     13,     11,     9.5,    9,      5,      4.75,   4.5,    4.25,   4.125,  4;
    47,     12.5,   10.5,   9,      8,      4.5,    4.375,  4.25,   4.15,   4,      3.875;
    41,     12,     10,     8,      7,      4,      3.875,  3.75,   3.625,  3.5,    3.4;
    36,     11,     9.5,    7.5,    6,      3.75,   3.5,    3.375,  3.125,  3,      2.9;
    33,     10,     9,      7,      5.5,    3.25,   3.125,  3,      2.9,    2.88,   2.8;
    30,     9,      8.5,    6.5,    5,      3,      2.8,    2.75,   2.7,    2.67,   2.6;
    28,     7,      6.8,    6.3,    4.9,    2.75,   2.6,    2.55,   2.5,    2.45,   2.4
];

% Internal resistance table R1 [ohms]
% Rows correspond to current values (I_bp)
% Columns correspond to SOC values (SOC_bp)
R1_tbl = [
    97.5,   50,             20,             15,             12,             10,     9,      8.5,    8.25,   8,      7.875;
    83,     42.56410256,    17.02564103,    12.76923077,    10.21538462,    9.75,   8.775,  8.2875, 8.04375, 7.8,   7.678125;
    76,     38.97435897,    15.58974359,    11.69230769,    16.69230769,    9.5,    8.55,   8.075,  7.8375, 7.6,    7.48125;
    69,     35.38461538,    14.15384615,    10.61538462,    15.61538462,    9.4,    8.46,   7.99,   7.755,  7.52,   7.4025;
    63,     32.30769231,    12.92307692,    9.692307692,    14.69230769,    9.25,   8.325,  7.8625, 7.63125, 7.4,   7.284375;
    58,     29.74358974,    11.8974359,     8.923076923,    13.92307692,    9.125,  8.2125, 7.75625, 7.528125, 7.3,  7.1859375;
    53,     27.17948718,    10.87179487,    8.153846154,    13.15384615,    9,      8.1,    7.65,   7.425,  7.2,    7.0875;
    48,     24.61538462,    9.846153846,    7.384615385,    12.38461538,    8.925,  8.0325, 7.58625, 7.363125, 7.14, 7.0284375;
    44,     22.56410256,    9.025641026,    6.769230769,    11.76923077,    8.875,  7.9875, 7.54375, 7.321875, 7.1,  6.9890625;
    40,     20.51282051,    9.25,           7.25,           12.25,          8.5,    7.65,   7.225,  7.0125, 6.8,    6.69375;
    36,     18.46153846,    9.75,           7.641891892,    12.64189189,    8.25,   7.425,  7.0125, 6.80625, 6.6,   6.496875;
    33,     16.92307692,    10.5,           8.22972973,     13.22972973,    8,      7.2,    6.8,    6.6,    6.4,    6.3;
    30,     15.38461538,    11.5,           9.013513514,    14.01351351,    7,      6.3,    5.95,   5.775,  5.6,    5.5125;
    28,     14.35897436,    12.75,          9.993243243,    14.99324324,    6,      5.4,    5.1,    4.95,   4.8,    4.725;
    27,     13.84615385,    14.75,          15.25,          14,             12,     10.8,   10.2,   9.9,    9.6,    9.45;
    25,     12.82051282,    15,             18,             15,             10,     9,      8.5,    8.25,   6.77,   6.5625
];
% Capacitance table C1 [Farads]
% Rows correspond to current values (I_bp)
% Columns correspond to SOC values (SOC_bp)
C1_tbl = [
    3.25,   4,      5,      6.75,   6.85,   7.75,   8,      9,      10,     11,     14;
    3.35,   5,      6.25,   8.25,   12.9,   13.9,   12.9,   12,     13.25,  18.25,  18.75;
    3.5,    6,      6.5,    8,      13.5,   15,     14.3,   12.3,   13.75,  18.5,   19.5;
    5,      5.5,    6,      10.5,   14,     15.5,   15.4,   12.5,   14,     18.75,  19.8;
    6,      5,      5.25,   12,     14.5,   16,     15.75,  12.8,   14.25,  19,     20;
    5,      4,      6,      12.75,  15,     16.25,  16,     13,     14.7,   19.3,   20.4;
    4.5,    4.35,   7,      13.25,  15.5,   16.4,   16.35,  13.25,  15,     19.6,   20.9;
    4.25,   4.5,    8,      13.75,  15.9,   16.7,   16.5,   13.5,   15.4,   20,     21.3;
    4,      5,      8.5,    14.25,  16.5,   17.2,   17,     14,     15.6,   19.7,   21;
    3.75,   6,      8.75,   14.85,  16.9,   17.5,   17.25,  13.75,  15.8,   19.6,   20;
    4,      7,      9,      14.25,  16.4,   17.3,   16.9,   14,     16,     18,     19.5;
    3.85,   5.6,    8.5,    13,     15.6,   16,     15.5,   13.5,   15.7,   16,     17;
    3.6,    5,      7.5,    11.75,  14.5,   15,     14.95,  13,     15,     15,     15.5;
    3.65,   4.95,   6.5,    10.25,  13.25,  14,     14.1,   12.6,   14,     14,     14.7;
    3.75,   4.75,   5.75,   8.5,    12.25,  12.8,   11,     12.4,   13,     13.5,   14;
    4.25,   4.5,    5,      8,      10.5,   11.5,   11,     12,     12.4,   13,     13.5
];
% Internal resistance table R2 [ohms]
% Rows correspond to current values (I_bp)
% Columns correspond to SOC values (SOC_bp)
R2_tbl = [
    127.5,  120,    40,     45,     48,     46,     41,     34,     31,     32,     30;
    110,    105,    30,     35,     38,     36,     31,     24,     21,     22,     20;
    93,     85,     20,     25,     28,     26,     21,     14,     12.5,   14,     11.5;
    80,     72,     12,     17,     20,     18,     13,     10,     8,      9.5,    7;
    72,     64.8,   8,      13,     16,     14,     9,      6,      4,      5.5,    3;
    65,     58.5,   6,      11,     14,     12,     7,      5,      3.5,    5.25,   2.75;
    58,     52.2,   5,      10,     13,     11,     6,      4,      2.5,    4.25,   2.25;
    51,     45.9,   4,      9,      12,     10,     5,      3.75,   2.25,   4,      2.25;
    44,     39.6,   4,      9,      12,     10,     5,      3,      1.5,    3.25,   1.5;
    40,     36,     3.75,   8.75,   11.75,  9.75,   4.75,   2.75,   1.25,   3,      1.25;
    36,     32.4,   3.5,    8.5,    11.5,   9.5,    4.5,    2.5,    1.5,    3.3,    2.05;
    33,     29.7,   3.25,   8.25,   11.25,  9.25,   4.25,   2.25,   1.25,   3.05,   1.8;
    30,     27,     3.125,  8.125,  11.125, 9.125,  4.125,  2.125,  1.475,  3.275,  2.025;
    28,     25.2,   3,      8,      11,     9,      4,      2,      1.35,   3.15,   1.9;
    27,     24.3,   3,      8,      11,     9,      4,      2,      1.35,   3.15,   1.9;
    25,     22.5,   2.95,   7.95,   10.95,  8.95,   3.95,   1.95,   1.3,    3.1,    1.85
];
% Capacitance table C2 [Farads]
% Rows correspond to current values (I_bp)
% Columns correspond to SOC values (SOC_bp)
C2_tbl = [
    45,     50,     58,     65,     67,     69,     73,     95,     125,    110,    120;
    52,     52,     60,     70,     72,     74,     78,     105,    145,    125,    140;
    55,     56,     66,     75,     77,     79,     85,     110,    165,    135,    160;
    59,     61,     71,     90,     92,     93,     98,     125,    190,    150,    180;
    62,     65,     75,     99,     94,     95,     101,    135,    205,    165,    190;
    63,     69,     79,     109,    105,    106,    109,    170,    220,    180,    200;
    63.5,   70,     80,     120,    110,    109,    111,    190,    235,    190,    210;
    64,     70.5,   80.5,   122,    112,    111,    114,    210,    260,    200,    220;
    64.25,  74.25,  84.25,  124,    110,    111,    115,    230,    270,    205,    230;
    64.5,   74.5,   84.5,   126,    111,    112,    118,    250,    285,    210,    235;
    64.75,  74.75,  84.75,  127,    112,    113,    120,    280,    295,    212,    240;
    65,     75,     85,     128,    110,    107,    120,    300,    305,    210,    245;
    65.1,   75.1,   85.1,   127,    115,    112,    118,    310,    312,    215,    250;
    65.25,  75.25,  85.25,  125,    118,    116,    119,    318,    318,    220,    255;
    65.3,   75.3,   85.3,   124,    115,    115,    119,    320,    324,    225,    260;
    65.4,   75.4,   85.4,   125,    116,    114,    118,    325,    330,    230,    265
];



% Capacitance table C3 [Farads]
% Rows correspond to current values (I_bp)
% Columns correspond to SOC values (SOC_bp)
a1_tbl_OG = [
    0.00315581854,  0.005,          0.01,           0.00987654321,  0.01216545012,  0.01290322581,  0.01388888889,  0.01307189542,  0.01212121212,  0.01136363636,  0.009070294785;
    0.003596475454, 0.004698795181, 0.009397590361, 0.009492515517, 0.007588493509, 0.007378712415, 0.008834117361, 0.01005530417,  0.009382650892, 0.007024938532, 0.006946140279;
    0.003759398496, 0.004276315789, 0.009868421053, 0.01069078947,  0.004437617341, 0.00701754386,  0.008178955547, 0.01006821214,  0.009279396839, 0.007112375533, 0.006854743697;
    0.002898550725, 0.005138339921, 0.01177536232,  0.008971704624, 0.00457424349,  0.006863417982, 0.00767553959,  0.01001251564,  0.009210647509, 0.007092198582, 0.006822701858;
    0.002645502646, 0.00619047619,  0.01473922902,  0.008597883598, 0.004693988084, 0.006756756757, 0.007626674293, 0.009936406995, 0.009195798669, 0.007112375533, 0.006864006864;
    0.003448275862, 0.008405172414, 0.01400862069,  0.008789722786, 0.004788213628, 0.006743940991, 0.007610350076, 0.00991756028,  0.009036408254, 0.007097735822, 0.006821602309;
    0.004192872117, 0.008458035133, 0.01314016173,  0.009255962976, 0.004904734956, 0.006775067751, 0.007550874014, 0.009865581453, 0.008978675645, 0.0070861678,   0.006750883944;
    0.004901960784, 0.009027777778, 0.0126953125,   0.009848484848, 0.005078323372, 0.006709270535, 0.007545105584, 0.009764254286, 0.008818954579, 0.00700280112,  0.006679771543;
    0.005681818182, 0.008863636364, 0.01303475936,  0.01036682616,  0.005149534561, 0.006550933508, 0.007364448127, 0.009468576163, 0.008754938332, 0.007149495961, 0.006813366974;
    0.006666666667, 0.008125,       0.01235521236,  0.00928828515,  0.004830334501, 0.006722689076, 0.007577910391, 0.01006605851,  0.009025474401, 0.0075030012,   0.007469654528;
    0.006944444444, 0.007738095238, 0.0113960114,   0.009182992849, 0.004823297832, 0.007006480995, 0.007969238738, 0.01018589254,  0.009182736455, 0.008417508418, 0.007893341227;
    0.007870916962, 0.01055194805,  0.01120448179,  0.009346974864, 0.004845341924, 0.0078125,      0.008960573477, 0.01089324619,  0.009650646593, 0.009765625,    0.009337068161;
    0.009259259259, 0.013,          0.0115942029,   0.009442087467, 0.004921358029, 0.009523809524, 0.01061740192,  0.01292824822,  0.01154401154,  0.0119047619,   0.01170360617;
    0.009784735812, 0.01406926407,  0.01206636501,  0.009762693976, 0.00503371398,  0.0119047619,   0.01313370108,  0.01556178027,  0.01443001443,  0.01488095238,  0.01439729331;
    0.00987654321,  0.01520467836,  0.01179071481,  0.007714561234, 0.00583090379,  0.006510416667, 0.008417508418, 0.007906388362, 0.00777000777,  0.007716049383, 0.007558578987;
    0.009411764706, 0.01733333333,  0.01333333333,  0.006944444444, 0.006349206349, 0.008695652174, 0.0101010101,   0.009803921569, 0.009775171065, 0.01136234519,  0.01128747795
];

a1_tbl = [
    0.00315581854,  0.005,          0.01,           0.00987654321,  0.01216545012,  0.01290322581,  0.01388888889,  0.01307189542,  0.01212121212,  0.01136363636,  0.009070294785;
    0.003596475454, 0.004698795181, 0.009397590361, 0.009492515517, 0.007588493509, 0.007378712415, 0.008834117361, 0.01005530417,  0.009381771087646484, 0.007024938532, 0.006946140279;
    0.003759398496, 0.004276315789, 0.009868421053, 0.01069078947,  0.004437617341, 0.00701754386,  0.008178955547, 0.01006821214,  0.009279396839, 0.007112375533, 0.006854743697;
    0.002898550725, 0.005138339921, 0.01177536232,  0.008971704624, 0.00457424349,  0.006863417982, 0.00767553959,  0.01001251564,  0.009210647509, 0.007092198582, 0.006822701858;
    0.002645502646, 0.00619047619,  0.01473922902,  0.008597883598, 0.004693988084, 0.006756756757, 0.007626674293, 0.009936406995, 0.009195798669, 0.007112375533, 0.006864006864;
    0.003448275862, 0.008405172414, 0.01400862069,  0.008789722786, 0.004788213628, 0.006743940991, 0.007610350076, 0.00991756028,  0.009036408254, 0.007097735822, 0.006821602309;
    0.004192872117, 0.008458035133, 0.01314016173,  0.009255962976, 0.004904734956, 0.006775067751, 0.007550874014, 0.009865581453, 0.008978675645, 0.0070861678,   0.006750883944;
    0.004901960784, 0.009027777778, 0.0126953125,   0.009848484848, 0.005078323372, 0.006709270535, 0.007545105584, 0.009764254286, 0.008818954579, 0.00700280112,  0.006679771543;
    0.005681818182, 0.008863636364, 0.01303475936,  0.01036682616,  0.005149534561, 0.006550933508, 0.007364448127, 0.009468576163, 0.008754938332, 0.007149495961, 0.006813366974;
    0.006666666667, 0.008125,       0.01235521236,  0.00928828515,  0.004830334501, 0.006722689076, 0.007577910391, 0.01006605851,  0.009025474401, 0.0075030012,   0.007469654528;
    0.006944444444, 0.007738095238, 0.0113960114,   0.009182992849, 0.004823297832, 0.007006480995, 0.007969238738, 0.01018589254,  0.009182736455, 0.008417508418, 0.007893341227;
    0.007870916962, 0.01055194805,  0.01120448179,  0.009346974864, 0.004845341924, 0.0078125,      0.008960573477, 0.01089324619,  0.009650646593, 0.009765625,    0.009337068161;
    0.009259259259, 0.013,          0.0115942029,   0.009442087467, 0.004921358029, 0.009523809524, 0.01061740192,  0.01292824822,  0.01154401154,  0.0119047619,   0.01170360617;
    0.009784735812, 0.01406926407,  0.01206636501,  0.009762693976, 0.00503371398,  0.0119047619,   0.01313370108,  0.01556178027,  0.01443001443,  0.01488095238,  0.01439729331;
    0.00987654321,  0.01520467836,  0.01179071481,  0.007714561234, 0.00583090379,  0.006510416667, 0.008417508418, 0.007906388362, 0.00777000777,  0.007716049383, 0.007558578987;
    0.009411764706, 0.01733333333,  0.01333333333,  0.006944444444, 0.006349206349, 0.008695652174, 0.0101010101,   0.009803921569, 0.009775171065, 0.01136234519,  0.01128747795
];

% Internal resistance table R3 [ohms]
% Rows correspond to current values (I_bp)
% Columns correspond to SOC values (SOC_bp)
c1_tbl_OG = [
    0.3076923077,   0.25,           0.2,            0.1481481481,   0.1459854015,   0.1290322581,   0.125,          0.1111111111,   0.1,            0.09090909091,  0.07142857143;
    0.2985074627,   0.2,            0.16,           0.1212121212,   0.07751937984,  0.07194244604,  0.07751937984,  0.08333333333,  0.07547169811,  0.05479452055,  0.05333333333;
    0.2857142857,   0.1666666667,   0.1538461538,   0.125,          0.07407407407,  0.06666666667,  0.06993006993,  0.08130081301,  0.07272727273,  0.05405405405,  0.05128205128;
    0.2,            0.1818181818,   0.1666666667,   0.09523809524,  0.07142857143,  0.06451612903,  0.06493506494,  0.08,           0.07142857143,  0.05333333333,  0.05050505051;
    0.1666666667,   0.2,            0.1904761905,   0.08333333333,  0.06896551724,  0.0625,         0.06349206349,  0.078125,       0.0701754386,   0.05263157895,  0.05;
    0.2,            0.25,           0.1666666667,   0.07843137255,  0.06666666667,  0.06153846154,  0.0625,         0.07692307692,  0.06802721088,  0.0518134715,   0.04901960784;
    0.2222222222,   0.2298850575,   0.1428571429,   0.07547169811,  0.06451612903,  0.06097560976,  0.06116207951,  0.07547169811,  0.06666666667,  0.05102040816,  0.04784688995;
    0.2352941176,   0.2222222222,   0.125,          0.07272727273,  0.06289308176,  0.05988023952,  0.06060606061,  0.07407407407,  0.06493506494,  0.05,           0.04694835681;
    0.25,           0.2,            0.1176470588,   0.0701754386,   0.06060606061,  0.05813953488,  0.05882352941,  0.07142857143,  0.0641025641,   0.05076142132,  0.04761904762;
    0.2666666667,   0.1666666667,   0.1142857143,   0.06734006734,  0.05917159763,  0.05714285714,  0.05797101449,  0.07272727273,  0.06329113924,  0.05102040816,  0.05;
    0.25,           0.1428571429,   0.1111111111,   0.0701754386,   0.06097560976,  0.05780346821,  0.05917159763,  0.07142857143,  0.0625,         0.05555555556,  0.05128205128;
    0.2597402597,   0.1785714286,   0.1176470588,   0.07692307692,  0.0641025641,   0.0625,         0.06451612903,  0.07407407407,  0.06369426752,  0.0625,         0.05882352941;
    0.2777777778,   0.2,            0.1333333333,   0.08510638298,  0.06896551724,  0.06666666667,  0.06688963211,  0.07692307692,  0.06666666667,  0.06666666667,  0.06451612903;
    0.2739726027,   0.202020202,    0.1538461538,   0.09756097561,  0.07547169811,  0.07142857143,  0.07092198582,  0.07936507937,  0.07142857143,  0.07142857143,  0.06802721088;
    0.2666666667,   0.2105263158,   0.1739130435,   0.1176470588,   0.08163265306,  0.078125,       0.09090909091,  0.08064516129,  0.07692307692,  0.07407407407,  0.07142857143;
    0.2352941176,   0.2222222222,   0.2,            0.125,          0.09523809524,  0.08695652174,  0.09090909091,  0.08333333333,  0.08064516129,  0.07692307692,  0.07407407407
];

c1_tbl = [
    0.3076923077,   0.25,           0.2,            0.1481481481,   0.1459854015,   0.1290322581,   0.125,          0.1111111111,   0.1,            0.09090909091,  0.07142857143;
    0.2985074627,   0.2,            0.16,           0.1212121212,   0.07751937984,  0.07194244604,  0.07751937984,  0.08333333333,  0.078094482421875,  0.05479452055,  0.05333333333;
    0.2857142857,   0.1666666667,   0.1538461538,   0.125,          0.07407407407,  0.06666666667,  0.06993006993,  0.08130081301,  0.07272727273,  0.05405405405,  0.05128205128;
    0.2,            0.1818181818,   0.1666666667,   0.09523809524,  0.07142857143,  0.06451612903,  0.06493506494,  0.08,           0.07142857143,  0.05333333333,  0.05050505051;
    0.1666666667,   0.2,            0.1904761905,   0.08333333333,  0.06896551724,  0.0625,         0.06349206349,  0.078125,       0.0701754386,   0.05263157895,  0.05;
    0.2,            0.25,           0.1666666667,   0.07843137255,  0.06666666667,  0.06153846154,  0.0625,         0.07692307692,  0.06802721088,  0.0518134715,   0.04901960784;
    0.2222222222,   0.2298850575,   0.1428571429,   0.07547169811,  0.06451612903,  0.06097560976,  0.06116207951,  0.07547169811,  0.06666666667,  0.05102040816,  0.04784688995;
    0.2352941176,   0.2222222222,   0.125,          0.07272727273,  0.06289308176,  0.05988023952,  0.06060606061,  0.07407407407,  0.06493506494,  0.05,           0.04694835681;
    0.25,           0.2,            0.1176470588,   0.0701754386,   0.06060606061,  0.05813953488,  0.05882352941,  0.07142857143,  0.0641025641,   0.05076142132,  0.04761904762;
    0.2666666667,   0.1666666667,   0.1142857143,   0.06734006734,  0.05917159763,  0.05714285714,  0.05797101449,  0.07272727273,  0.06329113924,  0.05102040816,  0.05;
    0.25,           0.1428571429,   0.1111111111,   0.0701754386,   0.06097560976,  0.05780346821,  0.05917159763,  0.07142857143,  0.0625,         0.05555555556,  0.05128205128;
    0.2597402597,   0.1785714286,   0.1176470588,   0.07692307692,  0.0641025641,   0.0625,         0.06451612903,  0.07407407407,  0.06369426752,  0.0625,         0.05882352941;
    0.2777777778,   0.2,            0.1333333333,   0.08510638298,  0.06896551724,  0.06666666667,  0.06688963211,  0.07692307692,  0.06666666667,  0.06666666667,  0.06451612903;
    0.2739726027,   0.202020202,    0.1538461538,   0.09756097561,  0.07547169811,  0.07142857143,  0.07092198582,  0.07936507937,  0.07142857143,  0.07142857143,  0.06802721088;
    0.2666666667,   0.2105263158,   0.1739130435,   0.1176470588,   0.08163265306,  0.078125,       0.09090909091,  0.08064516129,  0.07692307692,  0.07407407407,  0.07142857143;
    0.2352941176,   0.2222222222,   0.2,            0.125,          0.09523809524,  0.08695652174,  0.09090909091,  0.08333333333,  0.08064516129,  0.07692307692,  0.07407407407
];


% Capacitance table C4 [Farads]
% Rows correspond to current values (I_bp)
% Columns correspond to SOC values (SOC_bp)
a2_tbl = [
    0.000174291939, 0.0001666666667, 0.0004310344828, 0.0003418803419, 0.0003109452736, 0.0003150598614, 0.0003341129302, 0.0003095975232, 0.0002580645161, 0.0002840909091, 0.0002777777778;
    0.0001748251748, 0.0001831501832, 0.0005555555556, 0.0004081632653, 0.000365497076,  0.0003753753754, 0.0004135649297, 0.0003968253968, 0.000328407225,  0.0003636363636, 0.0003571428571;
    0.0001955034213, 0.0002100840336, 0.0007575757576, 0.0005333333333, 0.0004638218924, 0.0004868549172, 0.0005602240896, 0.0006493506494, 0.0004848484848, 0.0005291005291, 0.0005434782609;
    0.0002118644068, 0.0002276867031, 0.00117370892,   0.0006535947712, 0.0005434782609, 0.0005973715651, 0.0007849293564, 0.0008,          0.0006578947368, 0.000701754386,  0.0007936507937;
    0.0002240143369, 0.0002374169041, 0.001666666667,  0.000777000777,  0.000664893617,  0.0007518796992, 0.001100110011,  0.001234567901,  0.001219512195,  0.001101928375, 0.001754385965;
    0.0002442002442, 0.0002477393782, 0.002109704641,  0.000834028357,  0.0006802721088, 0.000786163522,  0.00131061599,   0.001176470588,  0.001298701299,  0.001058201058, 0.001818181818;
    0.0002715177844, 0.0002736726875, 0.0025,          0.0008333333333, 0.0006993006993, 0.000834028357,  0.001501501502,  0.001315789474,  0.00170212766,   0.001238390093, 0.002116402116;
    0.000306372549,  0.0003090282606, 0.003105590062,  0.0009107468124, 0.000744047619,  0.0009009009009, 0.001754385965,  0.00126984127,   0.001709401709,  0.00125,         0.00202020202;
    0.0003537318712, 0.0003401013502, 0.00296735905,   0.0008960573477, 0.0007575757576, 0.0009009009009, 0.001739130435,  0.001449275362,  0.002469135802,  0.001500938086, 0.002898550725;
    0.0003875968992, 0.0003728560776, 0.00315581854,   0.0009070294785, 0.000766724171,  0.0009157509158, 0.00178412132,   0.001454545455,  0.002807017544,  0.001587301587, 0.003404255319;
    0.000429000429,  0.0004128989636, 0.003371260008,  0.0009263547939, 0.0007763975155, 0.0009315323707, 0.001851851852,  0.001428571429,  0.002259887006,  0.001429388222, 0.002032520325;
    0.0004662004662, 0.0004489337823, 0.003619909502,  0.000946969697,  0.0008080808081, 0.001010356151,  0.001960784314,  0.001481481481,  0.00262295082,   0.00156128025,  0.002267573696;
    0.0005120327701, 0.000493169601,  0.003760282021,  0.0009691096305, 0.0007816316561, 0.0009784735812, 0.002054442732,  0.001518026565,  0.002172968275,  0.001420202379, 0.001975308642;
    0.0005473453749, 0.00052734272,   0.003910068426,  0.001,           0.0007704160247, 0.0009578544061, 0.002100840336,  0.001572327044,  0.002329373399,  0.001443001443, 0.002063983488;
    0.000567182803,  0.0005465108018, 0.003907776475,  0.001008064516,  0.000790513834,  0.0009661835749, 0.002100840336,  0.0015625,       0.002286236854,  0.001410934744, 0.002024291498;
    0.0006116207951, 0.0005894488653, 0.003969356567,  0.001006289308,  0.0007872775941, 0.000980103891,  0.002145462347,  0.00157790927,   0.002331002331,  0.001402524544, 0.002039775625
];

% Internal resistance table R4 [ohms]
% Rows correspond to current values (I_bp)
% Columns correspond to SOC values (SOC_bp)
c2_tbl = [
    0.02222222222,  0.02,           0.01724137931,  0.01538461538,  0.01492537313,  0.01449275362,  0.01369863014,  0.01052631579,  0.008,          0.009090909091, 0.008333333333;
    0.01923076923,  0.01923076923,  0.01666666667,  0.01428571429,  0.01388888889,  0.01351351351,  0.01282051282,  0.009523809524, 0.006896551724, 0.008,          0.007142857143;
    0.01818181818,  0.01785714286,  0.01515151515,  0.01333333333,  0.01298701299,  0.01265822785,  0.01176470588,  0.009090909091, 0.006060606061, 0.007407407407, 0.00625;
    0.01694915254,  0.01639344262,  0.01408450704,  0.01111111111,  0.01086956522,  0.01075268817,  0.01020408163,  0.008,          0.005263157895, 0.006666666667, 0.005555555556;
    0.01612903226,  0.01538461538,  0.01333333333,  0.0101010101,   0.01063829787,  0.01052631579,  0.009900990099, 0.007407407407, 0.00487804878,  0.006060606061, 0.005263157895;
    0.01587301587,  0.01449275362,  0.01265822785,  0.009174311927, 0.009523809524, 0.009433962264, 0.009174311927, 0.005882352941, 0.004545454545, 0.005555555556, 0.005;
    0.0157480315,   0.01428571429,  0.0125,         0.008333333333, 0.009090909091, 0.009174311927, 0.009009009009, 0.005263157895, 0.004255319149, 0.005263157895, 0.004761904762;
    0.015625,       0.01418439716,  0.01242236025,  0.008196721311, 0.008928571429, 0.009009009009, 0.008771929825, 0.004761904762, 0.003846153846, 0.005,          0.004545454545;
    0.01556420233,  0.01346801347,  0.0118694362,   0.008064516129, 0.009090909091, 0.009009009009, 0.008695652174, 0.004347826087, 0.003703703704, 0.00487804878,  0.004347826087;
    0.01550387597,  0.01342281879,  0.01183431953,  0.007936507937, 0.009009009009, 0.008928571429, 0.008474576271, 0.004,          0.00350877193,  0.004761904762, 0.004255319149;
    0.01544401544,  0.01337792642,  0.01179941003,  0.007874015748, 0.008928571429, 0.008849557522, 0.008333333333, 0.003571428571, 0.003389830508, 0.004716981132, 0.004166666667;
    0.01538461538,  0.01333333333,  0.01176470588,  0.0078125,      0.009090909091, 0.009345794393, 0.008333333333, 0.003333333333, 0.003278688525, 0.004761904762, 0.004081632653;
    0.0153609831,   0.01331557923,  0.01175088132,  0.007874015748, 0.008695652174, 0.008928571429, 0.008474576271, 0.003225806452, 0.003205128205, 0.004651162791, 0.004;
    0.0153256705,   0.01328903654,  0.01173020528,  0.008,          0.008474576271, 0.008620689655, 0.008403361345, 0.003144654088, 0.003144654088, 0.004545454545, 0.003921568627;
    0.01531393568,  0.01328021248,  0.01172332943,  0.008064516129, 0.008695652174, 0.008695652174, 0.008403361345, 0.003125,       0.003086419753, 0.004444444444, 0.003846153846;
    0.01529051988,  0.01326259947,  0.01170960187,  0.008,          0.008620689655, 0.008771929825, 0.008474576271, 0.003076923077, 0.00303030303,  0.004347826087, 0.003773584906
];

% Display dimensions for verification
fprintf('R0_tbl dimensions:  %d x %d\n', size(R0_tbl, 1), size(R0_tbl, 2));
fprintf('Current breakpoints: %d elements\n', length(I_bp));
fprintf('SOC breakpoints: %d elements\n', length(SOC_bp));

% In Simulink 2D Lookup Table block, configure as follows:
% - Row index input: Current (I)
% - Column index input: SOC
% - Table data:  R0_tbl
% - Row breakpoints: I_bp
% - Column breakpoints: SOC_bp